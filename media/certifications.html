<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Certifications & Training | Matthew Dubea</title>
  <meta name="description" content="Verified certifications, technical training, and professional memberships for Matthew Dubea." />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#0a66c2" />
  <link rel="icon" href="../assets/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="../style.css" />

  <!-- Page-scoped styles (keep here so you can paste once) -->
  <style>
    /* Page chrome */
    .hero { padding-bottom: 1rem; }
    .hint  { text-align:center; color:var(--muted); margin:.5rem 0 .25rem; font-size:.95rem; }

    /* Sticky toolbar: search + filter chips */
    .toolbar {
      position: sticky; top: 0; z-index: 20;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border);
      padding: .75rem 0 .5rem;
    }
    @media (max-width: 720px){ .toolbar { padding-top:.5rem; } }

    /* Filters */
    .filters {
      display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center; margin:.5rem auto 0;
      max-width: 1160px; padding: 0 1rem;
    }
    .filters button {
      border: 1px solid var(--border);
      background: var(--surface);
      padding: .45rem .75rem;
      border-radius: 999px;
      font-size: .9rem;
      cursor: pointer;
    }
    .filters button.active {
      background: #eef6ff;
      border-color: var(--border-strong, #c9d7e8);
      font-weight: 600;
    }

    /* Section index pills under hero */
    .section-index {
      display:flex; flex-wrap:wrap; gap:.35rem; justify-content:center; margin-top:.75rem;
    }
    .section-index a {
      display:inline-block; padding:.25rem .6rem; border:1px solid var(--border);
      border-radius:999px; font-size:.88rem; background:var(--surface);
    }

    /* Certification grid/cards */
    .cert-section { margin: 1rem auto; max-width: 1160px; padding: 0 1rem; }
    .cert-section summary { list-style:none; cursor:default; }
    .cert-section summary::-webkit-details-marker { display:none; }
    .cert-section .section-title { margin: .25rem 0 1rem; text-align:left; }
    .certifications-grid {
      display:grid; gap:.9rem;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    @media (max-width: 1024px){ .certifications-grid { grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width: 640px){ .certifications-grid { grid-template-columns: 1fr; } }

    .cert-card {
      display:grid; grid-template-columns: 72px 1fr; gap: .85rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: .9rem 1rem;
      box-shadow: 0 10px 30px var(--shadow);
      align-items: start;
    }
    .cert-card .ico {
      width: 56px; height: 56px; border-radius: 10px; display:grid; place-items:center;
      border: 1px solid var(--border);
      background: linear-gradient(180deg,#f7faff,#eef4fb);
      font-size: 1.25rem;
    }
    .cert-title { font-weight: 700; margin: 0 0 .25rem; }
    .cert-badges { display:flex; flex-wrap:wrap; gap:.35rem; margin:.35rem 0 .5rem; }
    .badge { display:inline-block; padding:.18rem .5rem; border:1px solid var(--border); border-radius:999px; font-size:.78rem; background:#f7fbff; }

    .cta-row { display:flex; gap:.5rem; flex-wrap:wrap; }
    .cta-row .btn { flex: 0 0 auto; }

    /* Compact ‚Äúno-preview‚Äù doc placeholder when desired */
    .doc-chip {
      font-size:.85rem; color:var(--muted);
      user-select:none;
    }
  </style>
</head>

<body class="fade-in">
  <header class="site-header">
    <div class="brand">
      <h1>Matthew Dubea</h1>
      <p class="tagline">Mechanical Engineer ¬∑ Design ¬∑ Fabrication ¬∑ Automation</p>
    </div>
    <nav class="site-nav" aria-label="Primary">
      <ul class="nav-links">
        <li><a href="../index.html">Home</a></li>
        <li><a href="../about.html">About</a></li>
        <li><a href="../resume.html">Resume</a></li>
        <li><a href="../reports.html">Reports</a></li>
        <li><a class="active" href="certifications.html" aria-current="page">Certifications</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero">
      <h2>Certifications & Training</h2>
      <p>All credentials are from verified technical training, professional associations, and engineering coursework.</p>
      <nav id="sectionIndex" class="section-index" aria-label="Quick index"></nav>
    </section>

    <!-- Sticky toolbar -->
    <div class="toolbar">
      <div class="searchbar" role="search" aria-label="Search certifications">
        <input id="certSearch" type="search" placeholder="Search title, issuer, category‚Ä¶" aria-label="Search by title, issuer, or category" />
        <span id="certCount" aria-live="polite" style="margin-left:.5rem;"></span>
      </div>
      <div id="filters" class="filters" role="tablist" aria-label="Filter categories"></div>
    </div>
    <p class="hint">Tip: use the filter chips or type to search across titles, issuers, and categories.</p>

    <!-- Sections are rendered here -->
    <div id="certSections"></div>
  </main>

  <footer>
    <p>¬© 2025 Matthew Dubea &nbsp;|&nbsp; <a href="mailto:mattdubea@outlook.com">mattdubea@outlook.com</a></p>
  </footer>

  <script>
    /* ========= Helpers ========= */
    const $  = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    const qs = new URLSearchParams(location.search);

    const filtersHost  = $('#filters');
    const indexHost    = $('#sectionIndex');
    const sectionsHost = $('#certSections');
    const searchInput  = $('#certSearch');
    const resultCount  = $('#certCount');

    // We keep all documents in /media; this page lives in /media/, so the base is that folder.
    // Build robust media URL regardless of trailing path.
    const MEDIA_BASE = location.pathname.replace(/\/[^\/]*$/, '/') || '/media/';

    function fileHref(file){
      // Ensure spaces are encoded but keep slashes intact.
      return encodeURI(MEDIA_BASE + (file || ''));
    }

    function escapeHTML(s){
      return (s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    }

    /* ========= Fetch & Render ========= */
    fetch('../certs.json', { cache: 'no-store' })
      .then(r => r.ok ? r.json() : Promise.reject(r.status))
      .then(json => render(json))
      .catch(err => {
        console.error('Failed to load certs.json', err);
        sectionsHost.innerHTML = '<p style="text-align:center;color:var(--muted)">Unable to load certifications right now.</p>';
      });

    function render(data){
      const groups = (data.groups || []).slice().sort((a,b)=> (a.order||0)-(b.order||0));

      // Index with group counts
      indexHost.innerHTML = groups
        .map(g => `<a href="#sec-${g.id}">${escapeHTML(g.title)} <span style="color:var(--muted)">(${(g.items||[]).length})</span></a>`)
        .join('');

      // Filters (All + group ids)
      const initial = (qs.get('filter') || 'all').toLowerCase();
      filtersHost.innerHTML = [
        `<button data-filter="all" class="${initial==='all'?'active':''}" role="tab" aria-selected="${initial==='all'}">All</button>`,
        ...groups.map(g => {
          const active = initial === String(g.id).toLowerCase();
          return `<button data-filter="${g.id}" class="${active?'active':''}" role="tab" aria-selected="${active}">${escapeHTML(g.title)}</button>`;
        })
      ].join('');

      // Sections -> cards (no <embed>, consistent cards)
      sectionsHost.innerHTML = groups.map(sectionTemplate).join('');
      groups.forEach(g => {
        const grid = document.getElementById(`grid-${g.id}`);
        (g.items||[]).forEach(item => grid.insertAdjacentHTML('beforeend', cardTemplate(item)));
      });

      setupFilters(initial);
      setupSearch();
    }

    function sectionTemplate(group){
      return `
        <section id="sec-${group.id}" class="cert-section" data-section data-id="${escapeHTML(group.id)}">
          <h3 class="section-title">${escapeHTML(group.title)}</h3>
          <div class="certifications-grid" id="grid-${group.id}"></div>
        </section>`;
    }

    // Simple doc icon based on type
    function iconFor(item){
      const t = (item.type||'pdf').toLowerCase();
      if (t === 'image') return 'üñºÔ∏è';
      if (t === 'pdf')   return 'üìÑ';
      return 'üìÅ';
    }

    function cardTemplate(item){
      const issuer  = item.issuer ? `Issuer: ${escapeHTML(item.issuer)}` : '';
      const badges  = (item.badges||[]).map(b => `<span class="badge">${escapeHTML(b)}</span>`).join('');
      const href    = fileHref(item.file);
      const openBtn = `<a class="btn outline" href="${href}" target="_blank" rel="noopener">Open</a>`;
      const dlBtn   = `<a class="btn outline" href="${href}" download>Download</a>`;
      const cats    = (item.category || []).join(' ').toLowerCase();

      return `
        <article class="cert-card" data-category="${cats}">
          <div class="ico" aria-hidden="true">${iconFor(item)}</div>
          <div class="cert-body">
            <div class="cert-title">${escapeHTML(item.title)}</div>
            <div class="cert-badges">
              ${issuer ? `<span class="badge">${issuer}</span>` : ''}${badges}
            </div>
            <div class="doc-chip">Preview not shown for consistency ¬∑ opens in a new tab</div>
            <div class="cta-row" style="margin-top:.5rem">${openBtn}${dlBtn}</div>
          </div>
        </article>`;
    }

    /* ========= Interactions ========= */
    function setupFilters(initial){
      let active = (initial || 'all').toLowerCase();
      const buttons  = $$('#filters button');
      const sections = $$('[data-section]');

      function apply(needle){
        const cards = $$('.cert-card');
        let visible = 0;

        cards.forEach(card => {
          const cats = (card.getAttribute('data-category') || '');
          const body = card.textContent.toLowerCase();
          const fOK  = active === 'all' || cats.split(/\s+/).includes(active);
          const sOK  = !needle || body.includes(needle);
          const show = fOK && sOK;
          card.hidden = !show;
          if (show) visible++;
        });

        // Hide sections with no visible cards
        sections.forEach(sec => {
          const hasVisible = sec.querySelector('.cert-card:not([hidden])');
          sec.hidden = !hasVisible;
        });

        if (resultCount) resultCount.textContent = visible ? `${visible} shown` : 'No results';
      }

      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          active = String(btn.dataset.filter).toLowerCase();
          // update URL quietly
          const url = new URL(location.href);
          if (active === 'all') url.searchParams.delete('filter');
          else url.searchParams.set('filter', active);
          history.replaceState({}, '', url);

          buttons.forEach(b => b.classList.toggle('active', b === btn));
          buttons.forEach(b => b.setAttribute('aria-selected', b === btn ? 'true' : 'false'));
          apply((searchInput?.value || '').toLowerCase());
        });
      });

      apply('');
    }

    function setupSearch(){
      searchInput?.addEventListener('input', () => {
        const activeBtn = $('#filters button.active') || $('#filters button[data-filter="all"]');
        // Re-apply current filter after text change
        activeBtn?.click();
      });
    }
  </script>
</body>
</html>
