<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover"
  />
  <title>Certifications & Training | Matthew Dubea</title>
  <meta name="description" content="Verified certifications, technical training, and professional memberships for Matthew Dubea." />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#0a66c2" />
  <link rel="icon" href="../assets/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="../style.css" />
  <script defer src="../theme.js"></script>
</head>

<body class="fade-in no-overscroll">
  <header class="site-header">
    <div class="brand">
      <h1>Matthew Dubea</h1>
      <p class="tagline">Mechanical Engineer 路 Design (CAD/CAE) 路 Lean Manufacturing 路 Process Automation</p>
    </div>
    <nav class="site-nav" aria-label="Primary">
      <ul class="nav-links">
        <li><a href="../index.html">Home</a></li>
        <li><a href="../about.html">About</a></li>
        <li><a href="../resume.html">Resume</a></li>
        <li><a href="../reports.html">Reports</a></li>
        <li><a class="active" href="certifications.html" aria-current="page">Certifications</a></li>
      </ul>
    </nav>
  </header>

  <!-- Hero -->
  <section class="hero hero--tight">
    <h2>Certifications & Training</h2>
    <p>All certifications are from verified technical training, professional associations, and engineering coursework.</p>
    <nav id="sectionIndex" class="section-index" aria-label="Section index"></nav>
  </section>

  <!-- Sticky search + filters -->
  <div class="toolbar-sticky">
    <div class="searchbar" role="search" aria-label="Search certifications">
      <input id="certSearch" type="search" placeholder="Search title, issuer, category" aria-label="Search by title, issuer, or category" />
      <span id="certCount" aria-live="polite" class="search-count"></span>
    </div>
    <div id="filters" class="filters" role="tablist" aria-label="Filter categories"></div>
  </div>
  <p class="hint">Tip: use the filter chips or type to search across titles, issuers, and categories.</p>

  <!-- Sections render here -->
  <div id="certSections" class="cert-section" aria-busy="true"></div>

  <footer>
    <p>漏 2025 Matthew Dubea &nbsp;|&nbsp; <a href="mailto:mattdubea@outlook.com">mattdubea@outlook.com</a></p>
  </footer>

  <script>
    /* ---------- device policy: inline PDFs only on desktop/laptop ---------- */
    const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
    const isIOS   = /iPad|iPhone|iPod/.test(navigator.userAgent) ||
                    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    const canInlinePDF = !isIOS && !isTouch && matchMedia('(min-width: 992px)').matches;
    if (!canInlinePDF) document.body.classList.add('no-embed');

    /* ---------- helpers ---------- */
    const $  = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    const qs = new URLSearchParams(location.search);
    const BASE = location.pathname.replace(/\/[^/]*$/, '/'); // current folder "/media/"

    function join(p1, p2) {
      if (!p1) return p2 || '';
      if (!p2) return p1;
      if (/^https?:\/\//.test(p2) || p2.startsWith('/')) return p2;
      return (p1.endsWith('/') ? p1 : p1 + '/') + p2.replace(/^\//,'');
    }
    const escapeHTML = s => (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));

    const sectionsHost = $('#certSections');
    const filtersHost  = $('#filters');
    const searchInput  = $('#certSearch');
    const resultCount  = $('#certCount');
    const indexHost    = $('#sectionIndex');

    /* ---------- load certs.json (root, then local) ---------- */
    (async function load() {
      try {
        const urls = ['/certs.json', '../certs.json', 'certs.json'];
        let json = null;
        for (const u of urls) {
          try {
            const r = await fetch(u, { cache: 'no-store' });
            if (r.ok) { json = await r.json(); break; }
          } catch {}
        }
        if (!json) throw new Error('certs.json not found');
        render(json);
      } catch (err) {
        console.error(err);
        sectionsHost.innerHTML = '<p class="muted" style="text-align:center">Unable to load certifications right now.</p>';
        sectionsHost.removeAttribute('aria-busy');
      }
    })();

    function render(json){
      const groups = (json.groups || []).sort((a,b) => (a.order||0) - (b.order||0));

      // section index
      indexHost.innerHTML = groups
        .map(g => `<a href="#sec-${g.id}">${escapeHTML(g.title)} <span class="muted">(${(g.items||[]).length})</span></a>`)
        .join(' 路 ');

      // filters
      const initial = (qs.get('filter') || 'all').toLowerCase();
      filtersHost.innerHTML = [
        `<button data-filter="all" class="${initial==='all'?'active':''}" role="tab" aria-selected="${initial==='all'}">All</button>`,
        ...groups.map(g => {
          const on = initial === (g.id||'').toLowerCase();
          return `<button data-filter="${g.id}" class="${on?'active':''}" role="tab" aria-selected="${on}">${escapeHTML(g.title)} <span class="muted">(${(g.items||[]).length})</span></button>`;
        })
      ].join('');

      // sections grid
      sectionsHost.innerHTML = groups.map(g => `
        <section id="sec-${g.id}">
          <h3 class="section-title"> ${escapeHTML(g.title)}</h3>
          <div class="certifications-grid" id="grid-${g.id}"></div>
        </section>
      `).join('');

      groups.forEach(g => {
        const grid = document.getElementById('grid-'+g.id);
        (g.items||[]).forEach(item => grid.insertAdjacentHTML('beforeend', cardTemplate(item)));
      });

      // lazy-load PDFs for desktop only
      if (canInlinePDF) lazyObjects();

      // interactions
      setupFilters(initial);
      setupSearch();
      applyFilter(initial, (searchInput?.value||'').toLowerCase());

      sectionsHost.removeAttribute('aria-busy');
    }

    function cardTemplate(item){
      const title  = escapeHTML(item.title || '');
      const issuer = escapeHTML(item.issuer || '');
      const file   = item.file ? join(BASE, item.file) : '';
      const badges = (item.badges || []).map(b => `<span class="badge">${escapeHTML(b)}</span>`).join('');

      // Pretty media area:
      // - Desktop: try <object> for inline preview
      // - Mobile/tablet: show a friendly gradient with icon
      const media = canInlinePDF && (item.type || '').toLowerCase() === 'pdf'
        ? `<div class="frame frame--ratio">
             <object type="application/pdf" data="" data-src="${file}">
               <div class="frame__fallback">
                 <div class="doc-icon"></div>
                 <div class="muted">Preview unavailable</div>
               </div>
             </object>
           </div>`
        : (item.type || '').toLowerCase() === 'image'
          ? `<div class="frame frame--ratio">
               <img class="frame-img" src="${file}" alt="${title}" loading="lazy" decoding="async" />
             </div>`
          : `<div class="frame frame--ratio">
               <div class="frame__fallback">
                 <div class="doc-icon"></div>
                 <div class="muted">Document preview not shown on mobile</div>
               </div>
             </div>`;

      return `
        <article class="cert-card" data-category="${(item.category||[]).join(' ').toLowerCase()}">
          ${media}
          <div class="cert-body">
            <div class="cert-title">${title}</div>
            <div class="cert-badges">
              ${issuer ? `<span class="badge">Issuer: ${issuer}</span>` : ''}${badges}
            </div>
          </div>
          <div class="cta-row">
            <a class="btn primary" href="${file}" target="_blank" rel="noopener">Open</a>
            <a class="btn outline" href="${file}" download>Download</a>
          </div>
        </article>`;
    }

    function lazyObjects(){
      const objs = $$('object[data-src]');
      if (!objs.length) return;

      const io = new IntersectionObserver(entries=>{
        entries.forEach(e=>{
          if (!e.isIntersecting) return;
          const el = e.target;
          const src = el.getAttribute('data-src');
          if (!src) return;
          el.setAttribute('data', src);
          // if the PDF plug-in errors, reveal the fallback
          el.addEventListener('error', () => {
            const fb = el.parentElement?.querySelector('.frame__fallback');
            if (fb) fb.style.display = 'grid';
            el.remove();
          });
          io.unobserve(el);
        });
      }, { rootMargin:'200px' });

      objs.forEach(o => io.observe(o));
    }

    function setupFilters(initial){
      let active = (initial||'all').toLowerCase();
      $$('#filters button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          active = btn.dataset.filter.toLowerCase();
          $$('#filters button').forEach(b=>{
            b.classList.toggle('active', b === btn);
            b.setAttribute('aria-selected', b===btn ? 'true' : 'false');
          });
          const url = new URL(location.href);
          if (active==='all') url.searchParams.delete('filter'); else url.searchParams.set('filter',active);
          history.replaceState({},'',url);
          applyFilter(active, (searchInput?.value||'').toLowerCase());
        });
      });
    }

    function setupSearch(){
      searchInput?.addEventListener('input', ()=>{
        const activeBtn = $('#filters button.active') || $('#filters button[data-filter="all"]');
        applyFilter(activeBtn?.dataset.filter || 'all', (searchInput?.value||'').toLowerCase());
      });
    }

    function applyFilter(active, needle){
      const cards = $$('.cert-card');
      let shown = 0;
      cards.forEach(card=>{
        const cats   = card.getAttribute('data-category') || '';
        const text   = card.textContent.toLowerCase();
        const passF  = active==='all' || cats.split(/\s+/).includes(active);
        const passQ  = !needle || text.includes(needle);
        const show   = passF && passQ;
        card.hidden  = !show;
        if (show) shown++;
      });
      if (resultCount) resultCount.textContent = shown ? `${shown} shown` : 'No results';
    }
  </script>
</body>
</html>
