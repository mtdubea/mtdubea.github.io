<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Matthew Dubea | Certifications</title>
  <meta name="description" content="All certifications and professional training for Matthew Dubea with mobile-safe PDF viewing and smart filtering." />
  <link rel="stylesheet" href="../style.css" />
  <link rel="icon" href="../assets/favicon.ico" type="image/x-icon" />
  <script defer src="../theme.js"></script>

  <!-- Rich result metadata for featured credentials -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "EducationalOccupationalCredential",
        "name": "SOLIDWORKS CSWA (Certified Associate)",
        "url": "CSWA_OFFICIAL.pdf",
        "issuer": { "@type": "Organization", "name": "Dassault Syst√®mes (SOLIDWORKS)" },
        "credentialCategory": "Certification"
      },
      {
        "@type": "EducationalOccupationalCredential",
        "name": "Six Sigma Black Belt (CSSC)",
        "url": "Official_Certification_Issued_Six_Sigma_Black_Belt_Certification_Standard.pdf",
        "issuer": { "@type": "Organization", "name": "The Council for Six Sigma Certification" },
        "credentialCategory": "Certification"
      },
      {
        "@type": "EducationalOccupationalCredential",
        "name": "ASME B31.12: Hydrogen Piping & Pipelines (Advanced)",
        "url": "Advanced_B31.12_Hydrogen_Piping_Pipelines.pdf",
        "issuer": { "@type": "Organization", "name": "ASME" },
        "credentialCategory": "Training"
      }
    ]
  }
  </script>
</head>

<body class="fade-in">
  <header class="site-header">
    <div class="brand">
      <h1>Matthew Dubea</h1>
      <p class="tagline">Mechanical Engineer ¬∑ Design ¬∑ Fabrication ¬∑ Automation</p>
    </div>
    <nav class="site-nav" aria-label="Primary">
      <ul class="nav-links">
        <li><a href="../index.html">Home</a></li>
        <li><a href="../about.html">About</a></li>
        <li><a href="../resume.html">Resume</a></li>
        <li><a href="../reports.html">Reports</a></li>
        <li><a class="active" aria-current="page" href="certifications.html">Certifications</a></li>
        <li class="theme-toggle"><button id="darkModeToggle" title="Toggle Dark Mode">üåì</button></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="hero">
      <h2>Certifications & Training</h2>
      <p>All certifications are from verified technical training, professional associations, and engineering coursework.</p>

      <!-- Quick anchor index -->
      <nav id="sectionIndex" class="section-index" aria-label="Section index"></nav>

      <!-- Global Search + Count -->
      <div class="searchbar" role="search" aria-label="Search certifications">
        <input id="searchInput" type="search" placeholder="Search title, issuer, category" aria-label="Search by title, issuer, or category" />
        <span id="resultCount" aria-live="polite" style="margin-left:.5rem;"></span>
      </div>

      <!-- Filter bar -->
      <div id="filters" class="filters" role="tablist" aria-label="Filter categories"></div>
    </section>

    <!-- Sections get injected here -->
    <div id="sections" class="fade-in"></div>
  </main>

  <!-- Lightbox (desktop-capable browsers only; disabled on mobile/iOS) -->
  <div id="lightbox" aria-hidden="true">
    <button class="close-lightbox" aria-label="Close">‚úï</button>
    <button id="prevBtn" class="nav-btn" aria-label="Previous">‚Üê</button>
    <iframe id="lightbox-content" frameborder="0" title="Certification document viewer"></iframe>
    <button id="nextBtn" class="nav-btn" aria-label="Next">‚Üí</button>
  </div>

  <footer>
    <p style="text-align:center;">¬© 2025 Matthew Dubea | <a href="mailto:mattdubea@outlook.com">mattdubea@outlook.com</a></p>
  </footer>

  <script>
  (function () {
    // ---------- Capability detection (robust iOS/mobile fallback) ----------
    const UA = navigator.userAgent || "";
    const isIOS = /iPad|iPhone|iPod/.test(UA) || (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(UA);
    const canEmbedPDF = !!(navigator.mimeTypes && navigator.mimeTypes["application/pdf"]);
    const isWide = matchMedia("(min-width: 900px)").matches;

    // Inline PDF only on wide screens, not iOS, and where the browser advertises PDF support.
    const INLINE_PDF_OK = isWide && !isIOS && canEmbedPDF;

    // ---------- Helpers ----------
    const $  = (s, r = document) => r.querySelector(s);
    const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));
    const sectionsHost = $("#sections");
    const filtersHost  = $("#filters");
    const indexHost    = $("#sectionIndex");
    const searchInput  = $("#searchInput");
    const resultCount  = $("#resultCount");
    const qs = new URLSearchParams(location.search);

    const escapeHTML = s => String(s).replace(/[&<>"']/g, c => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
    const escapeAttr = s => escapeHTML(s).replace(/"/g, "&quot;");

    // ---------- Build UI from certs.json ----------
    fetch("certs.json", { cache: "no-store" })
      .then(r => r.json())
      .then(data => {
        const groups = (data.groups || [])
          .slice()
          .sort((a, b) => (a.order || 9999) - (b.order || 9999));

        // Anchor index
        indexHost.innerHTML = groups.map(g => `<a href="#sec-${escapeAttr(g.id)}">${escapeHTML(g.title)}</a>`).join(" ‚Ä¢ ");

        // Filters (All + groups)
        const initialFilter = (qs.get("filter") || "all").toLowerCase();
        filtersHost.innerHTML =
          `<button data-filter="all" class="tab ${initialFilter === "all" ? "active" : ""}" role="tab" aria-selected="${initialFilter === "all"}">All</button>` +
          groups.map(g => {
            const active = initialFilter === String(g.id).toLowerCase();
            return `<button data-filter="${escapeAttr(g.id)}" class="tab ${active ? "active" : ""}" role="tab" aria-selected="${active}">${escapeHTML(g.title)}</button>`;
          }).join("");

        // Sections and cards
        sectionsHost.innerHTML = groups.map(g => renderGroup(g)).join("");

        // A‚ÜíZ sort within sections unless data-sort-exempt
        $$('[data-section]:not([data-sort-exempt]) .certifications-grid').forEach(grid => {
          const cards = Array.from(grid.children);
          cards.sort((a,b) => {
            const ta = a.querySelector('.cert-title')?.textContent.trim().toLowerCase() || '';
            const tb = b.querySelector('.cert-title')?.textContent.trim().toLowerCase() || '';
            return ta.localeCompare(tb);
          });
          cards.forEach(c => grid.appendChild(c));
        });

        // Lazy-load embeds (desktop capable only)
        if (INLINE_PDF_OK) setupLazyEmbeds();

        // Wire up behaviors
        setupFilters();
        setupSearch();
        applyFilterAndSearch(); // initialize count

        // Lightbox (desktop capable only)
        if (INLINE_PDF_OK) setupLightbox();

        // On mobile or when embed isn't supported, clicking a card opens the file in a new tab
        if (!INLINE_PDF_OK) {
          sectionsHost.addEventListener("click", e => {
            const card = e.target.closest(".cert-card");
            if (!card) return;
            if (e.target.closest(".download-link")) return;
            const src = card.getAttribute("data-file");
            if (src) window.open(src, "_blank", "noopener");
          });
        }

        // Prefetch PDFs on hover (desktop) for snappier open
        if (!isMobile) {
          sectionsHost.addEventListener("mouseenter", e => {
            const card = e.target.closest(".cert-card");
            if (!card) return;
            const src = card.getAttribute("data-file") || "";
            if (!src.toLowerCase().endsWith(".pdf")) return;
            const l = document.createElement("link");
            l.rel = "prefetch";
            l.href = src;
            document.head.appendChild(l);
          }, true);
        }

      })
      .catch(err => {
        console.error("Failed to load certs.json", err);
        sectionsHost.innerHTML = `<p style="text-align:center;color:var(--muted);">Unable to load certifications.</p>`;
      });

    // ---------- Renderers ----------
    function renderGroup(group) {
      const items = (group.items || []).map(renderCard).join("");
      const sortExempt = group.sort_exempt ? " data-sort-exempt" : "";
      return `
        <details id="sec-${escapeAttr(group.id)}" data-section${sortExempt} open>
          <summary><h3 class="section-title">${escapeHTML(group.title)}</h3></summary>
          <div class="certifications-grid">
            ${items}
          </div>
        </details>
      `;
    }

    function renderCard(item) {
      const file = item.file;
      const cat  = (item.category || []).join(" ");
      const badges = (item.badges || []).map(b => `<span class="badge">${escapeHTML(b)}</span>`).join("");

      // MEDIA AREA
      let mediaHTML = "";
      if (item.type === "pdf") {
        if (INLINE_PDF_OK) {
          mediaHTML = `<embed class="media" data-src="${escapeAttr(file)}" type="application/pdf" />`;
        } else {
          // Placeholder on mobile / iOS / small viewports
          mediaHTML = `
            <div class="media" aria-label="PDF preview unavailable" style="display:flex;align-items:center;justify-content:center;font-weight:600;">
              PDF Preview
            </div>
          `;
        }
      } else if (item.type === "image") {
        mediaHTML = `<img class="media" src="${escapeAttr(file)}" alt="${escapeAttr(item.title)}" />`;
      } else {
        mediaHTML = `<div class="media" style="display:flex;align-items:center;justify-content:center;"><span style="opacity:.7;">Document</span></div>`;
      }

      // CTA: always a download; add "Open PDF" button when inline is not available
      const openBtn = (!INLINE_PDF_OK && item.type === "pdf")
        ? `<a class="btn outline" href="${escapeAttr(file)}" target="_blank" rel="noopener">Open PDF</a>`
        : "";

      return `
        <div class="cert-card" data-file="${escapeAttr(file)}" data-category="${escapeAttr(cat)}">
          ${mediaHTML}
          <div class="cert-body">
            <div class="cert-title">${escapeHTML(item.title)}</div>
            <div class="cert-badges">${badges}</div>
            <a class="download-link" href="${escapeAttr(file)}" download>‚¨á Download</a>
            ${openBtn}
          </div>
        </div>
      `;
    }

    // ---------- Search + Filter ----------
    function cardMatches(card, needle, cat) {
      if (cat !== "all") {
        const cats = (card.getAttribute("data-category") || "").toLowerCase().split(/\s+/);
        if (!cats.includes(cat)) return false;
      }
      if (!needle) return true;

      const t = (card.querySelector(".cert-title")?.textContent || "").toLowerCase();
      const issuer = (card.querySelector(".cert-badges")?.textContent || "").toLowerCase();
      const cats = (card.getAttribute("data-category") || "").toLowerCase();
      return t.includes(needle) || issuer.includes(needle) || cats.includes(needle);
    }

    let activeFilter = (qs.get("filter") || "all").toLowerCase();

    function applyFilterAndSearch() {
      const needle = (searchInput?.value || "").trim().toLowerCase();
      const cards = $$(".cert-card");
      let visible = 0;

      cards.forEach(card => {
        const show = cardMatches(card, needle, activeFilter);
        card.hidden = !show;
        if (show) visible++;
      });

      // Toggle sections (hide when empty)
      $$("[data-section]").forEach(sec => {
        const hasVisible = sec.querySelector(".cert-card:not([hidden])");
        sec.hidden = !hasVisible;
        if (hasVisible) sec.setAttribute("open", "");
      });

      if (resultCount) resultCount.textContent = visible ? `${visible} shown` : "No results";
    }

    function setupFilters() {
      const btns = $$("#filters .tab");
      btns.forEach(btn => {
        btn.addEventListener("click", () => {
          activeFilter = (btn.dataset.filter || "all").toLowerCase();
          btns.forEach(b => b.classList.toggle("active", b === btn));
          // Persist to URL (no reload)
          const url = new URL(location.href);
          if (activeFilter === "all") url.searchParams.delete("filter");
          else url.searchParams.set("filter", activeFilter);
          history.replaceState({}, "", url);
          applyFilterAndSearch();
        });
      });
    }

    function setupSearch() {
      if (searchInput) searchInput.addEventListener("input", applyFilterAndSearch);
    }

    // ---------- Lazy loading for embeds (desktop only) ----------
    function setupLazyEmbeds() {
      const lazy = [];
      $$(".cert-card embed.media").forEach(el => {
        const s = el.getAttribute("data-src");
        if (s) lazy.push(el);
      });
      if (!lazy.length) return;

      const io = new IntersectionObserver(entries => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            const el = e.target;
            const src = el.getAttribute("data-src");
            if (src && !el.getAttribute("src")) {
              el.setAttribute("src", src);
              io.unobserve(el);
            }
          }
        });
      }, { rootMargin: "200px" });

      lazy.forEach(el => io.observe(el));
    }

    // ---------- Lightbox (desktop only) ----------
    function setupLightbox() {
      const lightbox = $("#lightbox");
      const frame = $("#lightbox-content");
      const prevBtn = $("#prevBtn");
      const nextBtn = $("#nextBtn");
      const closeBtn = $(".close-lightbox");
      let currentIndex = -1;
      let lastFocused = null;

      function visibleCards() {
        return $$(".cert-card").filter(c => !c.hidden && c.offsetParent !== null);
      }
      function indexFromSrc(src) {
        const list = visibleCards();
        return list.findIndex(c => (c.getAttribute("data-file") || "") === src);
      }
      function openLightbox(src) {
        lastFocused = document.activeElement;
        currentIndex = indexFromSrc(src);
        frame.src = src;
        lightbox.classList.add("open");
        lightbox.setAttribute("aria-modal", "true");
        lightbox.setAttribute("role", "dialog");
        closeBtn.focus();
        document.addEventListener("keydown", onKey);
        document.addEventListener("focus", trapFocus, true);
      }
      function closeLightbox() {
        lightbox.classList.remove("open");
        frame.src = "about:blank";
        document.removeEventListener("keydown", onKey);
        document.removeEventListener("focus", trapFocus, true);
        if (lastFocused) lastFocused.focus();
      }
      function showAt(index) {
        const list = visibleCards();
        if (!list.length) return;
        currentIndex = (index + list.length) % list.length;
        const src = list[currentIndex].getAttribute("data-file");
        frame.src = src;
      }
      function onKey(e) {
        if (e.key === "Escape") { e.preventDefault(); closeLightbox(); }
        if (e.key === "ArrowLeft") { e.preventDefault(); showAt(currentIndex - 1); }
        if (e.key === "ArrowRight") { e.preventDefault(); showAt(currentIndex + 1); }
        if (e.key === "Tab") trapFocus(e);
      }
      function trapFocus(e) {
        const focusables = $$('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])', lightbox)
          .filter(el => !el.hasAttribute("disabled"));
        if (!lightbox.classList.contains("open") || !focusables.length) return;
        const first = focusables[0];
        const last = focusables[focusables.length - 1];
        if (e.type === "focus") {
          if (!lightbox.contains(document.activeElement)) first.focus();
          return;
        }
        if (e.key === "Tab") {
          if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
          else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
        }
      }

      prevBtn.addEventListener("click", e => { e.stopPropagation(); showAt(currentIndex - 1); });
      nextBtn.addEventListener("click", e => { e.stopPropagation(); showAt(currentIndex + 1); });
      closeBtn.addEventListener("click", e => { e.stopPropagation(); closeLightbox(); });
      lightbox.addEventListener("click", e => { if (e.target === lightbox) closeLightbox(); });

      // Open lightbox when clicking any card (except download link)
      document.addEventListener("click", (e) => {
        const card = e.target.closest(".cert-card");
        if (!card) return;
        if (e.target.closest(".download-link")) return;
        const src = card.getAttribute("data-file");
        const isPDF = src && src.toLowerCase().endsWith(".pdf");
        if (isPDF) {
          e.preventDefault();
          openLightbox(src);
        } else if (src) {
          window.open(src, "_blank", "noopener");
        }
      });
    }
  })();
  </script>
</body>
</html>
