<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Matthew Dubea | Certifications</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="icon" href="../assets/favicon.ico" type="image/x-icon" />
  <script defer src="../theme.js"></script>

  <!-- Rich result metadata for featured credentials -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "EducationalOccupationalCredential",
        "name": "SOLIDWORKS CSWA (Certified Associate)",
        "url": "CSWA_OFFICIAL.pdf",
        "issuer": { "@type": "Organization", "name": "Dassault Syst√®mes (SOLIDWORKS)" },
        "credentialCategory": "Certification"
      },
      {
        "@type": "EducationalOccupationalCredential",
        "name": "Six Sigma Black Belt (CSSC)",
        "url": "Official_Certification_Issued_Six_Sigma_Black_Belt_Certification_Standard.pdf",
        "issuer": { "@type": "Organization", "name": "The Council for Six Sigma Certification" },
        "credentialCategory": "Certification"
      },
      {
        "@type": "EducationalOccupationalCredential",
        "name": "ASME B31.12: Hydrogen Piping & Pipelines (Advanced)",
        "url": "Advanced_B31.12_Hydrogen_Piping_Pipelines.pdf",
        "issuer": { "@type": "Organization", "name": "ASME" },
        "credentialCategory": "Training"
      }
    ]
  }
  </script>

  <!-- Page-scoped styles (page-specific variables, search, print) -->
  <style>
    :root {
      /* page-scoped tokens (moved to CSS later if desired) */
      --card-w: 360px;
      --card-h-media: 240px;
      --gap: 1rem;
      --border: #e2e8f0;
      --muted: #6b7280;
      --accent: var(--accent, #0a66c2);
      --badge-bg: #eef2f7;
    }
    .section-index, .filters { display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center; margin:1rem 0 1.25rem; }
    .filters button { padding:.4rem .7rem; border:1px solid var(--border); background:#f8f9fb; cursor:pointer; border-radius:.5rem; font-size:.9rem; }
    .filters button.active { outline:2px solid var(--accent); }
    .searchbar { display:flex; align-items:center; justify-content:center; gap:.5rem; margin:.75rem 0; }
    .searchbar input[type="search"] { width:min(680px, 90vw); padding:.5rem .75rem; border:1px solid var(--border); border-radius:.5rem; font-size:1rem; }
    details { margin:2rem auto; max-width:1200px; }
    summary { list-style:none; cursor:pointer; }
    summary::-webkit-details-marker { display:none; }
    .section-title { text-align:center; font-size:clamp(1.4rem, 2vw + .5rem, 2rem); margin:0 0 .75rem; font-weight:700; }
    .certifications-grid { display:grid; gap:var(--gap); grid-template-columns:repeat(auto-fit, minmax(var(--card-w), 1fr)); align-items:start; }
    .cert-card { width:100%; max-width:var(--card-w); border:1px solid var(--border); border-radius:.75rem; background:#fff; overflow:hidden; margin-inline:auto; }
    .cert-card .media { width:100%; height:var(--card-h-media); background:#fafafa; display:block; border-bottom:1px solid var(--border); }
    .cert-card embed.media { width:100%; height:100%; }
    .cert-card img.media { width:100%; height:100%; object-fit:cover; }
    .cert-body { padding:.75rem .9rem 1rem; }
    .cert-title { font-weight:600; line-height:1.25; margin-bottom:.4rem; }
    .cert-badges { display:flex; flex-wrap:wrap; gap:.4rem; margin:.35rem 0 .6rem; }
    .badge { font-size:.75rem; padding:.2rem .45rem; border-radius:.35rem; background:var(--badge-bg); color:#111827; border:1px solid var(--border); }
    .download-link { display:inline-block; font-size:.85rem; color:var(--accent); text-decoration:none; margin-top:.2rem; }
    .download-link:focus { outline:2px solid var(--accent); outline-offset:2px; }
    #lightbox { position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index:1000; }
    #lightbox.open { display:flex; }
    #lightbox-content { width:84vw; height:84vh; background:#fff; border-radius:.5rem; }
    .close-lightbox { position:absolute; top:1rem; right:1rem; padding:.4rem .6rem; font-size:1rem; }
    .nav-btn { position:absolute; top:50%; transform:translateY(-50%); padding:.6rem .8rem; background:rgba(255,255,255,.9); border:1px solid var(--border); border-radius:.5rem; cursor:pointer; }
    #prevBtn { left:1rem; } #nextBtn { right:1rem; }
    details[hidden] { display:none !important; }
    :focus-visible { outline:3px solid var(--accent); outline-offset:2px; }
    @media print {
      .filters, .searchbar, .section-index, nav.site-nav, header.site-header, footer { display:none !important; }
      details { max-width:100% !important; margin:0 !important; }
      .certifications-grid { display:block !important; }
      .cert-card { page-break-inside:avoid; max-width:100% !important; margin:0 0 1rem 0 !important; }
      .cert-card .media { height:320px !important; }
    }
  </style>

  <!-- Data source (self-contained; no network fetch) -->
  <script id="certs-data" type="application/json">
  {
    "groups": [
      {
        "id": "cswa",
        "title": "CSWA",
        "order": 1,
        "sort_exempt": true,
        "items": [
          {
            "title": "SOLIDWORKS CSWA (Certified Associate)",
            "file": "CSWA_OFFICIAL.pdf",
            "category": ["cswa"],
            "badges": ["Issuer: SOLIDWORKS", "Level: Associate"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "ssbb",
        "title": "Six Sigma Black Belt",
        "order": 2,
        "sort_exempt": true,
        "items": [
          {
            "title": "Six Sigma Black Belt (CSSC)",
            "file": "Official_Certification_Issued_Six_Sigma_Black_Belt_Certification_Standard.pdf",
            "category": ["six-sigma"],
            "badges": ["Issuer: CSSC", "Level: Black Belt"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "asme",
        "title": "ASME & Engineering Standards",
        "order": 3,
        "sort_exempt": true,
        "items": [
          {
            "title": "ASME B31.12: Hydrogen Piping & Pipelines (Intro)",
            "file": "ASME_B31.12_Hydrogen%20Piping%20and%20Pipelines.pdf",
            "category": ["asme"],
            "badges": ["Issuer: ASME"],
            "type": "pdf"
          },
          {
            "title": "ASME B31.12: Hydrogen Piping & Pipelines (Advanced)",
            "file": "Advanced_B31.12_Hydrogen_Piping_Pipelines.pdf",
            "category": ["asme"],
            "badges": ["Issuer: ASME"],
            "type": "pdf"
          },
          {
            "title": "ASME BPV Code Sec V: Nondestructive Examination (Overview)",
            "file": "NDE.pdf",
            "category": ["asme"],
            "badges": ["Issuer: ASME"],
            "type": "pdf"
          },
          {
            "title": "ASME Boiler & Pressure Vessel: Certification Process",
            "file": "ASME%20Boiler%20&%20Pressure%20Vessel.pdf",
            "category": ["asme"],
            "badges": ["Issuer: ASME"],
            "type": "pdf"
          },
          {
            "title": "ASME Drawing Interpretation: GD&T",
            "file": "GDnT.pdf",
            "category": ["asme"],
            "badges": ["Issuer: ASME"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "pm",
        "title": "Project Management & PMI",
        "order": 10,
        "items": [
          {
            "title": "Agile Project Management",
            "file": "AgileProjectManagement.pdf",
            "category": ["pmi"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "Project Management Essentials",
            "file": "Project_Management_Essentials-348043249.pdf",
            "category": ["pmi"],
            "badges": ["Issuer: ASME"],
            "type": "pdf"
          },
          {
            "title": "Microsoft Project: Planning for Successful Project Management",
            "file": "--PMI_MicrosoftProject.Project.Management.pdf",
            "category": ["pmi"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "Practical GitHub Project Management & Collaboration",
            "file": "--PMI-GitHub_Project_Management.pdf",
            "category": ["pmi"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "autocad",
        "title": "AutoCAD",
        "order": 20,
        "items": [
          {
            "title": "AutoCAD 2025: Essential Training",
            "file": "-AutoCAD.2025.Essential.Training.pdf",
            "category": ["autocad"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "AutoCAD 2026: Essential Training",
            "file": "-AutoCAD.2026.Essential.Training.pdf",
            "category": ["autocad"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "Learning AutoCAD 2026",
            "file": "-AutoCAD2026.pdf",
            "category": ["autocad"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "sap",
        "title": "SAP",
        "order": 30,
        "items": [
          {
            "title": "SAP MM: Materials Management",
            "file": "-SAP.MM_MaterialsManagement.pdf",
            "category": ["sap"],
            "badges": ["Issuer: SAP"],
            "type": "pdf"
          },
          {
            "title": "SAP Business One: Essential Training",
            "file": "CertificateOfCompletion_SAP%20Business%20One%20Essential%20Training.pdf",
            "category": ["sap"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "SAP ERP: Essential Training",
            "file": "CertificateOfCompletion_SAP%20ERP%20Essential%20Training.pdf",
            "category": ["sap"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "SAP Financials: Essential Training",
            "file": "CertificateOfCompletion_SAP%20Financials%20Essential%20Training.pdf",
            "category": ["sap"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "nx",
        "title": "Siemens NX",
        "order": 40,
        "items": [
          {
            "title": "Learning Siemens NX",
            "file": "-SiemensNX.pdf",
            "category": ["nx"],
            "badges": ["Issuer: Siemens"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "revit",
        "title": "Revit (MEP)",
        "order": 50,
        "items": [
          {
            "title": "Revit 2023: Essential Training for MEP",
            "file": "-Revit.2023.MEP.pdf",
            "category": ["revit"],
            "badges": ["Issuer: Autodesk"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "arch-cad",
        "title": "Architecture CAD Technician",
        "order": 60,
        "items": [
          {
            "title": "Architecture CAD Technician (32 hours)",
            "file": "-32hours.ArchitectureCADTechnician.pdf",
            "category": ["arch-cad"],
            "badges": ["Issuer: LinkedIn Learning", "Hours: 32h"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "power-bi",
        "title": "Power BI",
        "order": 70,
        "items": [
          {
            "title": "Power BI: Data Methods",
            "file": "CertificateOfCompletion_Power%20BI%20Data%20Methods.pdf",
            "category": ["power-bi"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "Power BI: Essential Training (Business Intelligence)",
            "file": "-PowerBI_Business_Intelligence_%28BI%29_MS_Power_BI.pdf",
            "category": ["power-bi"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "Power BI: Essential Training (2024)",
            "file": "CertificateOfCompletion_Power%20BI%20Essential%20Training%202024.pdf",
            "category": ["power-bi"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "Complete Guide to Power BI for Data Analysts",
            "file": "CertificateOfCompletion_Complete%20Guide%20to%20Power%20BI%20for%20Data%20Analysts%20by%20Microsoft%20Press.pdf",
            "category": ["power-bi"],
            "badges": ["Issuer: Microsoft Press"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "programming",
        "title": "Programming & GitHub",
        "order": 80,
        "items": [
          {
            "title": "PCAP: Programming Essentials in Python (OpenEDG)",
            "file": "OpenEDG_PCAP_PythonInstitute_ProgrammingwithPython.pdf",
            "category": ["programming"],
            "badges": ["Issuer: OpenEDG Python Institute"],
            "type": "pdf"
          },
          {
            "title": "Career Essentials: GitHub Copilot (Professional Certificate)",
            "file": "CertificateOfCompletion_Career%20Essentials%20in%20GitHub%20Copilot%20Professional%20Certificate.pdf",
            "category": ["programming"],
            "badges": ["Issuer: Microsoft / LinkedIn"],
            "type": "pdf"
          },
          {
            "title": "Career Essentials in GitHub ‚Äî Professional Certificate",
            "file": "CareerEssentialsinGitHubProfessionalCertificate.pdf",
            "category": ["programming"],
            "badges": ["Issuer: Microsoft / LinkedIn"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "data",
        "title": "Data Science & Analytics",
        "order": 90,
        "items": [
          {
            "title": "Data Science Professional ‚Äî KNIME",
            "file": "DataScienceProfessional-KNIME.pdf",
            "category": ["data"],
            "badges": ["Issuer: KNIME"],
            "type": "pdf"
          },
          {
            "title": "Learning Data Analytics 1: Foundations",
            "file": "LearningDataAnalytics1Foundations.pdf",
            "category": ["data"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "matlab",
        "title": "MATLAB",
        "order": 100,
        "items": [
          {
            "title": "MATLAB: Onramp",
            "file": "MATLAB_OnRamp_Cert.pdf",
            "category": ["matlab"],
            "badges": ["Issuer: MathWorks"],
            "type": "pdf"
          },
          {
            "title": "MATLAB: Machine Learning Onramp",
            "file": "MATLAB_MachineLearning_OnRamp_Certification.pdf",
            "category": ["matlab"],
            "badges": ["Issuer: MathWorks"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "lean",
        "title": "Lean / Business",
        "order": 110,
        "items": [
          {
            "title": "Lean Six Sigma: White Belt",
            "file": "Lean_Six_Sigma_White_Belt-348043276.pdf",
            "category": ["lean","six-sigma"],
            "badges": ["Issuer: CSSC / LinkedIn"],
            "type": "pdf"
          },
          {
            "title": "Process Improvement: Foundations",
            "file": "CertificateOfCompletion_Process%20Improvement%20Foundations.pdf",
            "category": ["lean"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          },
          {
            "title": "Business Management Essentials (Certified)",
            "file": "Business_Management_Essentials_Certified-348043411.pdf",
            "category": ["lean"],
            "badges": ["Issuer: LinkedIn Learning"],
            "type": "pdf"
          }
        ]
      },
      {
        "id": "safety",
        "title": "Safety",
        "order": 120,
        "items": [
          {
            "title": "OSHA 10-Hour: Health & Safety",
            "file": "OSHA_10_Hour_Health_&_Safety.png",
            "category": ["safety"],
            "badges": ["Issuer: OSHA"],
            "type": "image"
          }
        ]
      },
      {
        "id": "memberships",
        "title": "Professional Memberships",
        "order": 130,
        "items": [
          {
            "title": "ASME ‚Äî Membership Certificate",
            "file": "ASME-membership-certificate.pdf",
            "category": ["memberships"],
            "badges": ["Issuer: ASME"],
            "type": "pdf"
          },
          {
            "title": "SME ‚Äî Membership Certificate",
            "file": "SocietyOfManufacturingEngineers_SME_MatthewDubea.pdf",
            "category": ["memberships"],
            "badges": ["Issuer: SME"],
            "type": "pdf"
          },
          {
            "title": "LES ‚Äî Membership Certificate",
            "file": "LES_Membership_Cert_Matthew_Dubea.pdf",
            "category": ["memberships"],
            "badges": ["Issuer: LES"],
            "type": "pdf"
          }
        ]
      }
    ]
  }
  </script>
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <h1>Matthew Dubea</h1>
      <p class="tagline">Mechanical Engineer ¬∑ Design ¬∑ Fabrication ¬∑ Automation</p>
    </div>
    <nav class="site-nav">
      <ul class="nav-links">
        <li><a href="../index.html">Home</a></li>
        <li><a href="../about.html">About</a></li>
        <li><a href="../resume.html">Resume</a></li>
        <li><a href="../reports.html">Reports</a></li>
        <li><a class="active" href="certifications.html">Certifications</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section>
      <h2 style="text-align:center;margin-bottom:.25rem;">Certifications & Training</h2>
      <p style="text-align:center;color:var(--muted);">All certifications are from verified technical training, professional associations, and engineering coursework.</p>
    </section>

    <!-- Quick Index (built from data) -->
    <nav class="section-index" id="sectionIndex" aria-label="Section index"></nav>

    <!-- Global Search -->
    <div class="searchbar" role="search" aria-label="Search certifications">
      <input id="searchInput" type="search" placeholder="Search title, issuer, category" aria-label="Search by title, issuer, or category" />
      <span id="resultCount" aria-live="polite" style="margin-left:.5rem;"></span>
    </div>

    <!-- Filter bar -->
    <div class="filters" id="filters" role="tablist" aria-label="Filter categories">
      <button data-filter="all" class="active" role="tab" aria-selected="true">All</button>
      <button data-filter="cswa" role="tab">CSWA</button>
      <button data-filter="six-sigma" role="tab">Six Sigma</button>
      <button data-filter="asme" role="tab">ASME</button>
      <button data-filter="pmi" role="tab">Project Mgmt & PMI</button>
      <button data-filter="autocad" role="tab">AutoCAD</button>
      <button data-filter="sap" role="tab">SAP</button>
      <button data-filter="nx" role="tab">Siemens NX</button>
      <button data-filter="revit" role="tab">Revit (MEP)</button>
      <button data-filter="arch-cad" role="tab">Architecture CAD Tech</button>
      <button data-filter="power-bi" role="tab">Power BI</button>
      <button data-filter="programming" role="tab">Programming & GitHub</button>
      <button data-filter="data" role="tab">Data & Analytics</button>
      <button data-filter="matlab" role="tab">MATLAB</button>
      <button data-filter="lean" role="tab">Lean/Business</button>
      <button data-filter="safety" role="tab">Safety</button>
      <button data-filter="memberships" role="tab">Memberships</button>
    </div>

    <!-- Sections populated from JSON -->
    <div id="sectionsRoot"></div>
  </main>

  <!-- Lightbox Viewer -->
  <div id="lightbox">
    <button class="close-lightbox" aria-label="Close">‚úï</button>
    <button id="prevBtn" class="nav-btn" aria-label="Previous">‚Üê</button>
    <iframe id="lightbox-content" frameborder="0" title="Certification document viewer"></iframe>
    <button id="nextBtn" class="nav-btn" aria-label="Next">‚Üí</button>
  </div>

  <footer>
    <p style="text-align:center;color:var(--muted);">¬© 2025 Matthew Dubea | <a href="mailto:mattdubea@outlook.com">mattdubea@outlook.com</a></p>
  </footer>

  <script>
    // ===== Helpers =====
    const $  = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const qs = new URLSearchParams(location.search);

    // ===== Data =====
    function getData() {
      const el = document.getElementById('certs-data');
      if (!el) return { groups: [] };
      try { return JSON.parse(el.textContent); }
      catch { return { groups: [] }; }
    }

    // Build section container
    function sectionTpl(group) {
      const det = document.createElement('details');
      det.id = `sec-${group.id}`;
      det.setAttribute('data-section','');
      if (group.sort_exempt) det.setAttribute('data-sort-exempt','');
      det.open = true;
      det.innerHTML = `
        <summary><h3 class="section-title">${group.title}</h3></summary>
        <div class="certifications-grid"></div>
      `;
      return det;
    }

    // Build a cert card
    function cardTpl(item) {
      const media = item.type === 'image'
        ? `<img class="media" data-src="${item.file}" alt="${item.title}" />`
        : `<embed class="media" data-src="${item.file}" type="application/pdf" />`;

      const badges = (item.badges || []).map(b => `<span class="badge">${b}</span>`).join('');
      const cats = (item.category || []).join(' ');

      const wrap = document.createElement('div');
      wrap.className = 'cert-card';
      wrap.setAttribute('data-file', item.file);
      wrap.setAttribute('data-category', cats);
      wrap.innerHTML = `
        ${media}
        <div class="cert-body">
          <div class="cert-title">${item.title}</div>
          <div class="cert-badges">${badges}</div>
          <a class="download-link" href="${item.file}" download>‚¨á Download</a>
        </div>
      `;
      return wrap;
    }

    // Build quick index
    function buildIndex(groups) {
      const idx = $('#sectionIndex');
      const frag = document.createDocumentFragment();
      groups.forEach(g => {
        const a = document.createElement('a');
        a.href = `#sec-${g.id}`;
        a.textContent = g.title;
        frag.appendChild(a);
        frag.appendChild(document.createTextNode(' ‚Ä¢ '));
      });
      if (frag.lastChild) frag.removeChild(frag.lastChild);
      idx.appendChild(frag);
    }

    // Sort A‚ÄìZ within non-priority groups
    function sortAZ(grid) {
      const cards = Array.from(grid.children);
      cards.sort((a,b) => {
        const ta = a.querySelector('.cert-title')?.textContent.trim().toLowerCase() || '';
        const tb = b.querySelector('.cert-title')?.textContent.trim().toLowerCase() || '';
        return ta.localeCompare(tb);
      });
      cards.forEach(c => grid.appendChild(c));
    }

    // Lazy load embeds/images
    function lazyLoad() {
      const els = $$('.cert-card .media');
      const io = new IntersectionObserver(entries => {
        entries.forEach(e => {
          if (!e.isIntersecting) return;
          const el = e.target;
          const src = el.getAttribute('data-src');
          if (src) {
            el.setAttribute('src', src);
            el.removeAttribute('data-src');
            io.unobserve(el);
          }
        });
      }, { rootMargin: '200px' });
      els.forEach(el => io.observe(el));
    }

    function visibleCards() {
      return $$('.cert-card').filter(c => !c.hidden && c.offsetParent !== null);
    }

    // ===== Filters & Search =====
    const filtersBar = $('#filters');
    const searchInput = $('#searchInput');
    const resultCount = $('#resultCount');

    function applyFilterAndSearch(active) {
      const needle = (searchInput?.value || '').trim().toLowerCase();
      let shown = 0;
      $$('.cert-card').forEach(card => {
        const cats = (card.getAttribute('data-category') || '').toLowerCase().split(/\s+/);
        const title = card.querySelector('.cert-title')?.textContent.toLowerCase() || '';
        const issuer = card.querySelector('.cert-badges')?.textContent.toLowerCase() || '';
        const catOK = (active === 'all') || cats.includes(active);
        const textOK = !needle || title.includes(needle) || issuer.includes(needle) || cats.join(' ').includes(needle);
        const show = catOK && textOK;
        card.hidden = !show;
        if (show) shown++;
      });

      // Hide empty sections
      $$('[data-section]').forEach(sec => {
        const anyVisible = sec.querySelector('.cert-card:not([hidden])');
        sec.hidden = !anyVisible;
        if (anyVisible) sec.setAttribute('open','');
      });

      if (resultCount) resultCount.textContent = shown ? `${shown} shown` : 'No results';
    }

    function initFilters() {
      const filterButtons = $$('#filters button');
      let active = (qs.get('filter') || 'all').toLowerCase();
      filterButtons.forEach(b => b.classList.toggle('active', b.dataset.filter.toLowerCase() === active));
      filtersBar.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-filter]');
        if (!btn) return;
        active = btn.dataset.filter.toLowerCase();
        filterButtons.forEach(b => b.classList.toggle('active', b === btn));
        const url = new URL(location.href);
        if (active === 'all') url.searchParams.delete('filter'); else url.searchParams.set('filter', active);
        history.replaceState({}, '', url);
        applyFilterAndSearch(active);
      });
      if (searchInput) searchInput.addEventListener('input', () => applyFilterAndSearch(active));
      applyFilterAndSearch(active);
    }

    // ===== Lightbox (keyboard + focus trap) =====
    const lightbox = $('#lightbox');
    const frame = $('#lightbox-content');
    const prevBtn = $('#prevBtn');
    const nextBtn = $('#nextBtn');
    const closeBtn = $('.close-lightbox');
    let currentIndex = -1;
    let lastFocused = null;

    function indexFromSrc(src) {
      const list = visibleCards();
      return list.findIndex(c => (c.getAttribute('data-file') || '') === src);
    }
    function showAt(i) {
      const list = visibleCards();
      if (!list.length) return;
      currentIndex = (i + list.length) % list.length;
      const src = list[currentIndex].getAttribute('data-file');
      frame.src = src;
    }
    function onKey(e) {
      if (e.key === 'Escape') { e.preventDefault(); closeLightbox(); }
      if (e.key === 'ArrowLeft') { e.preventDefault(); showAt(currentIndex - 1); }
      if (e.key === 'ArrowRight') { e.preventDefault(); showAt(currentIndex + 1); }
      if (e.key === 'Tab') trapFocus(e);
    }
    function trapFocus(e) {
      const focusables = Array.from(lightbox.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])')).filter(el => !el.disabled);
      if (!lightbox.classList.contains('open') || !focusables.length) return;
      const first = focusables[0], last = focusables[focusables.length - 1];
      if (e.type === 'focus') { if (!lightbox.contains(document.activeElement)) first.focus(); return; }
      if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
      else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
    }
    function openLightbox(src) {
      lastFocused = document.activeElement;
      currentIndex = indexFromSrc(src);
      frame.src = src;
      lightbox.classList.add('open');
      lightbox.setAttribute('aria-modal','true');
      lightbox.setAttribute('role','dialog');
      closeBtn.focus();
      document.addEventListener('keydown', onKey);
      document.addEventListener('focus', trapFocus, true);
      track('lightbox_open', { src });
    }
    function closeLightbox() {
      lightbox.classList.remove('open');
      frame.src = 'about:blank';
      document.removeEventListener('keydown', onKey);
      document.removeEventListener('focus', trapFocus, true);
      if (lastFocused) lastFocused.focus();
      track('lightbox_close', {});
    }
    prevBtn.addEventListener('click', e => { e.stopPropagation(); showAt(currentIndex - 1); });
    nextBtn.addEventListener('click', e => { e.stopPropagation(); showAt(currentIndex + 1); });
    closeBtn.addEventListener('click', e => { e.stopPropagation(); closeLightbox(); });
    lightbox.addEventListener('click', e => { if (e.target === lightbox) closeLightbox(); });

    // Open on card click (ignore download clicks)
    document.addEventListener('click', (e) => {
      const card = e.target.closest('.cert-card');
      if (!card) return;
      if (e.target.closest('.download-link')) { track('download_click', { file: card.getAttribute('data-file') }); return; }
      const src = card.getAttribute('data-file');
      if (src) openLightbox(src);
    });

    // Basic analytics hook (replace with GA/gtag if desired)
    function track(event, data) {
      console.debug('[certs]', event, data || {});
    }

    // ===== Boot =====
    (function boot() {
      const data = getData();
      const groups = [...(data.groups || [])].sort((a,b) => (a.order||999) - (b.order||999));

      // Build index and sections
      buildIndex(groups);
      const root = $('#sectionsRoot');
      const frag = document.createDocumentFragment();

      groups.forEach(g => {
        const sec = sectionTpl(g);
        const grid = sec.querySelector('.certifications-grid');
        (g.items || []).forEach(it => grid.appendChild(cardTpl(it)));
        if (!g.sort_exempt) sortAZ(grid);
        frag.appendChild(sec);
      });

      root.appendChild(frag);

      // Lazy load media after DOM insert
      lazyLoad();

      // Init filters/search
      initFilters();
    })();
  </script>
</body>
</html>
